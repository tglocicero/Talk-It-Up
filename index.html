<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Talk It Up! Web App</title>

    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styleguide.css">
    <link rel="stylesheet" href="css/styles.css">
    <!-- Custom styles for this template -->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.debug.js"></script>
    <script src='js/pdfmake.min.js'></script>
    <script src='js/vfs_fonts.js'></script>
</head>

<body>

<!-- Modals -->
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">x</button>
                <h4 class="modal-title">Your Artifact Preview</h4>
            </div>
            <div id="preview-artifact" class="modal-body">
                <div>
                    <h1 id="preview-event-name" style="text-align: center"></h1>
                </div>
                <div>
                    <h4 id="preview-org-name-hdr" style="text-align: center"></h4>
                    <h2 id="preview-org-name" style="text-align: center"></h2>
                </div>
                <div>
                    <h3 id="preview-summary-hdr"></h3>
                    <p id="preview-summary-text"></p>
                </div>
                <div>
                    <h3 id="preview-goals-hdr"></h3>
                    <p id="preview-goals-text"></p>
                </div>
                <div>
                    <h3 id="preview-successes-hdr"></h3>
                    <p id="preview-successes-text"></p>
                </div>
                <div>
                    <h3 id="preview-feedback-hdr"></h3>
                    <p id="preview-feedback-text"></p>
                </div>
                <div>
                    <h3 id="preview-additional-info-hdr"></h3>
                    <p id="preview-additional-info-text"></p>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button class="btn btn-default" id="exportPDF">Generate PDF</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="selectionModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                <h4 class="modal-title" id="selection-modal-title"></h4>
            </div>
            <div class="modal-body" id="selection-modal-text">
                Where would you like to put the selected text?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" onclick="copySummaryText()">Summary</button>
                <button type="button" class="btn btn-default" onclick="copyGoalsText()">Goals</button>
                <button type="button" class="btn btn-default" onclick="copySuccessesText()">Successes</button>
                <button type="button" class="btn btn-default" onclick="copyFeedbackText()">Feedback</button>
                <button type="button" class="btn btn-default" onclick="copyAdditionalInfoText()">Additional Info</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="container">

    <div class="page-header">
        <h1>Talk It Up!</h1>
        <div id="nav">
            <!-- <button type="button" class="btn btn-default navbar-btn navbar-right"
                    style="margin-right: 10px; margin-left: 10px">
                Finish
            </button> -->
            <button onclick="preparePreview()" type="button" class="btn btn-default navbar-btn navbar-right myButton" data-toggle="modal" data-target="#myModal"
                    style="margin-right: 10px; margin-left: 10px">
                Preview
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-6">
            <h2 style="text-align: center;
                position: relative;
                top: 50%;
                transform: translateY(-50%);
                margin-bottom: 10px;">Notes</h2>
            <div class="form-group tab-pane">
                <textarea class="form-control" rows="24" id="notes-text" placeholder="Enter your notes here."
                          onmouseup="showSelectionModal()"></textarea>
            </div>

            <button onclick="preparePreview()" type="button" class="btn btn-default navbar-btn navbar-left myButton" data-toggle="modal" data-target="#imageModal"
                    style="margin-right: 10px; margin-left: 10px">
                Add Images
                </button>

            <div class="modal fade" id="imageModal">
                <div class="modal-dialog">
                    <div class="modal-content" >
                        <div id="upload">
                            <h2>Upload Images</h2>
                            <input type="file" id="files" name="files[]" multiple />
                            <output id="list" style=" overflow-y: scroll;"></output>

                            <script>
                              function handleFileSelect(evt) {
                                var files = evt.target.files; // FileList object

                               // Loop through the FileList and render image files as thumbnails.
                               for (var i = 0, f; f = files[i]; i++) {

                                 // Only process image files.
                                 if (!f.type.match('image.*')) {
                                   continue;
                                 }

                                 var reader = new FileReader();

                                 // Closure to capture the file information.
                                 reader.onload = (function(theFile) {
                                   return function(e) {
                                      // Render thumbnail.
                                      var span = document.createElement('span');
                                      span.innerHTML = ['<div class="thumbnail"><img src="', e.target.result,
                                                    '" alt="', escape(theFile.name), '"id=img', i, '></div>'].join('');
                                      document.getElementById('list').insertBefore(span, null);
                                };
                                  })(f);

                                  // Read in the image file as a data URL.
                                  reader.readAsDataURL(f);
                                }
                              }


                             </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <h2 style="text-align: center;
                position: relative;
                top: 50%;
                transform: translateY(-50%);
                margin-bottom: 10px;">Artifact</h2>
            <div class="form-group tab-pane">
                <div class="panel-group">
                            <h4 class="panel-title">
                                <a >
                                    <label for="event-name">Event Name</label>
                                </a>
                            </h4>
                                <textarea class="form-control" rows="1" id="event-name" placeholder="Enter the name of the event."></textarea>
                </div>

                <div class="panel-group">
                            <h4 class="panel-title">
                                <a >
                                    <label for="org-name">Organization Name</label>
                                </a>
                            </h4>

                                <textarea class="form-control" rows="1" id="org-name" placeholder="Enter the name of your community organization."></textarea>
                </div>

                <div class="panel-group">
                    <div class="panel panel-default" >
                        <div class="panel-heading" data-toggle="collapse" href="#collapse3">
                            <h4 class="panel-title">
                                <a >
                                    <label for="summary">Summary</label>
                                </a>
                            </h4>
                        </div>
                        <div id="collapse3" class="panel-collapse collapse">
                            <div class="panel-body">
                                <textarea class="form-control" maxlength="140" rows="5" id="summary" placeholder="Enter a brief summary of the event (140 characters or less)."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel-group">
                    <div class="panel panel-default" >
                        <div class="panel-heading" data-toggle="collapse" href="#collapse4">
                            <h4 class="panel-title">
                                <a >
                                    <label for="goals">Goals</label>
                                </a>
                            </h4>
                        </div>
                        <div id="collapse4" class="panel-collapse collapse">
                            <div class="panel-body">
                                <textarea class="form-control" rows="5" id="goals" placeholder="Explain how the event relates to your organization's goals."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel-group">
                    <div class="panel panel-default" >
                        <div class="panel-heading" data-toggle="collapse" href="#collapse5">
                            <h4 class="panel-title">
                                <a >
                                    <label for="successes">Successes</label>
                                </a>
                            </h4>
                        </div>
                        <div id="collapse5" class="panel-collapse collapse">
                            <div class="panel-body">
                                <textarea class="form-control" rows="5" id="successes" placeholder="Describe any successes your organization achieved through this event."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel-group">
                    <div class="panel panel-default" >
                        <div class="panel-heading" data-toggle="collapse" href="#collapse6">
                            <h4 class="panel-title">
                                <a >
                                    <label for="feedback">Feedback</label>
                                </a>
                            </h4>
                        </div>
                        <div id="collapse6" class="panel-collapse collapse">
                            <div class="panel-body">
                                <textarea class="form-control" rows="5" id="feedback" placeholder="Enter any feedback your organization received from attendees."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel-group">
                    <div class="panel panel-default" >
                        <div class="panel-heading" data-toggle="collapse" href="#collapse7">
                            <h4 class="panel-title">
                                <a >
                                    <label for="additional-info">Additional Info</label>
                                </a>
                            </h4>
                        </div>
                        <div id="collapse7" class="panel-collapse collapse">
                            <div class="panel-body">
                                <textarea class="form-control" rows="5" id="additional-info" placeholder="Enter any additional information that you would like to include about the event."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- /.container -->


<script>

    $('#exportPDF').click(function () {
        var eventname = document.getElementById('preview-event-name').innerText;
        var orgname = document.getElementById('preview-org-name').innerText;
        var summary = document.getElementById('preview-summary-text').innerText;
        var goals = document.getElementById('preview-goals-text').innerText;
        var successes = document.getElementById('preview-successes-text').innerText;
        var feedback = document.getElementById('preview-feedback-text').innerText;
        var additionalinfo = document.getElementById('preview-additional-info-text').innerText;
        var image = document.getElementById('img1').src;
        // var images[];
        // for (int i = 0; i < $('#list > span').length; i++) {
        //     images.push()
        // }
        var docDefinition = {
            content: [
                { text: eventname, style: 'EventName' },
                { text: 'Hosted By:', alignment: 'center' },
                { text: orgname, style: 'OrgName' },
                " ",
                { text: document.getElementById('preview-summary-hdr').innerText, style: 'SubHeading' },
                summary,
                " ",
                { text: document.getElementById('preview-goals-hdr').innerText, style: 'SubHeading' },
                goals,
                " ",
                { text: document.getElementById('preview-successes-hdr').innerText, style: 'SubHeading' },
                successes,
                " ",
                { text: document.getElementById('preview-feedback-hdr').innerText, style: 'SubHeading' },
                feedback,
                " ",
                { text: document.getElementById('preview-additional-info-hdr').innerText, style: 'SubHeading' },
                additionalinfo,
                { image: document.getElementById('img1').src},
                image
            ],

            styles: {
                EventName: {
                    fontSize: 36,
                    alignment: 'center',
                    bold: true
                },
                OrgName: {
                    fontSize: 22,
                    alignment: 'center'
                },
                SubHeading: {
                    fontSize: 16,
                    alignment: 'left'
                }
            }
        };

        // download the PDF
        pdfMake.createPdf(docDefinition).download('Artifact.pdf');
    });

    function copySummaryText() {
        var text = document.getElementById("selection-modal-title").innerText;
        $('#selectionModal').modal('hide');
        document.getElementById("summary").innerText = text;
        $('#collapse3').collapse('show');
    }
    function copyGoalsText() {
        var text = document.getElementById("selection-modal-title").innerText;
        $('#selectionModal').modal('hide');
        document.getElementById("goals").innerText = text;
        $('#collapse4').collapse('show');
    }
    function copySuccessesText() {
        var text = document.getElementById("selection-modal-title").innerText;
        $('#selectionModal').modal('hide');
        document.getElementById("successes").innerText = text;
        $('#collapse5').collapse('show');
    }
    function copyFeedbackText() {
        var text = document.getElementById("selection-modal-title").innerText;
        $('#selectionModal').modal('hide');
        document.getElementById("feedback").innerText = text;
        $('#collapse6').collapse('show');
    }
    function copyAdditionalInfoText() {
        var text = document.getElementById("selection-modal-title").innerText;
        $('#selectionModal').modal('hide');
        document.getElementById("additional-info").innerText = text;
        $('#collapse7').collapse('show');
    }

    function preparePreview() {
        var eventNameText = document.getElementById("event-name").value;
        if (eventNameText != "") {
            document.getElementById("preview-event-name").innerText = eventNameText;
        }

        var orgNameText = document.getElementById("org-name").value;
        if (orgNameText != "") {
            document.getElementById("preview-org-name-hdr").innerText = "Hosted By:"
            document.getElementById("preview-org-name").innerText = orgNameText;
        }
        var summaryText = document.getElementById("summary").value;
        if (summaryText != "") {
            document.getElementById("preview-summary-hdr").innerText = "Summary"
            document.getElementById("preview-summary-text").innerText = summaryText;
        }
        var goalsText = document.getElementById("goals").value;
        if (goalsText != "") {
            document.getElementById("preview-goals-hdr").innerText = "Goals"
            document.getElementById("preview-goals-text").innerText = goalsText;
        }
        var successesText = document.getElementById("successes").value;
        if (successesText != "") {
            document.getElementById("preview-successes-hdr").innerText = "Successes"
            document.getElementById("preview-successes-text").innerText = successesText;
        }
        var feedbackText = document.getElementById("feedback").value;
        if (feedbackText != "") {
            document.getElementById("preview-feedback-hdr").innerText = "Feedback"
            document.getElementById("preview-feedback-text").innerText = feedbackText;
        }
        var additionalInfoText = document.getElementById("additional-info").value;
        if (additionalInfoText != "") {
            document.getElementById("preview-additional-info-hdr").innerText = "Additional Info"
            document.getElementById("preview-additional-info-text").innerText = additionalInfoText;
        }

    }

    function showSelectionModal() {
        document.getElementById("selection-modal-title").innerText = getSelectedText(document.getElementById("notes-text"));
        $('#selectionModal').modal('show');
    }

    function getSelectedText(input) {
        var text = getSelection(input);

        if(text == null || text.length == 0) text = "nothing returned";

        return text;
    }

    function getSelection(textbox)
    {
        var selectedText = null;
        var activeElement = document.activeElement;

        // all browsers (including IE9 and up), except IE before version 9
        if (window.getSelection && activeElement &&
            (activeElement.tagName.toLowerCase() == "textarea" || (activeElement.tagName.toLowerCase() == "input" && activeElement.type.toLowerCase() == "text")) &&
            activeElement === textbox)
        {    var startIndex = textbox.selectionStart;
            var endIndex = textbox.selectionEnd;

            if(endIndex - startIndex > 0)
            {
                var text = textbox.value;
                selectedText = text.substring(textbox.selectionStart, textbox.selectionEnd);
            }
        }
        else if (document.selection && document.selection.type == "Text" &&  document.selection.createRange) // All Internet Explorer
        {
            var range = document.selection.createRange();
            selectedText = range.text;
        }

        return selectedText;
    }


</script>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->

<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>-->
</body>
</html>
